{% extends "base.html" %}

{% block content %}
<h1>Jsi přihlášen jako admin!</h1>

<div style="margin-bottom: 20px;">
    <a href="/dashboard/admin/users" class="btn-small" style="background-color: #28a745; font-size: 14px; padding: 8px 15px; text-decoration: none; color: white;">
        Spravovat uživatele
    </a>
</div>

<table>
  <tr>
    <th>ID</th>
    <th>Značka</th>
    <th>Datum</th>
    <th>Poznámka</th>
    <th>Stav</th>
    <th>Práce</th>
    <th>Mechanik (Přiřazení)</th>
    <th>Akce</th>
  </tr>
  {% for o in objednavky %}
  <tr>
    <td>{{ o.id_objednavky }}</td>
    <td>{{ o.znacka }}</td>
    <td>{{ o.datum }}</td>
    <td>{{ o.poznamka }}</td>
    <td>{{ o.stav }}</td>
    <td>
      {% for s in o.servisy %}
        <div class="work-item">
            <strong>{{ s.prace_nazev }}</strong>
            {% if s.id_mechanik %}
                <br><small>(mechanik ID: {{ s.id_mechanik }})</small>
            {% else %}
                <br><small class="no-mechanic">(bez mechanika)</small>
            {% endif %}
        </div>
      {% endfor %}

      <form action="/dashboard/admin/pridat_praci" method="post" class="add-work-form">
          <input type="hidden" name="id_obj" value="{{ o.id_objednavky }}">
          
          <select name="id_prace" required>
              <option value="" disabled selected>+ Přidat práci</option>
              {% for p in prace %}
                  <option value="{{ p.ID_prace }}">{{ p.nazev_prace }}</option>
              {% endfor %}
          </select>
          
          <button type="submit" class="btn-small">Přidat</button>
      </form>
    </td>
    
    <td>
    {% for s in o.servisy %}
     <form action="/dashboard/admin/pridel_mechanik" method="post" class="work-item">
        <input type="hidden" name="id_servisu" value="{{ s.id }}">
        
        <select name="id_mechanik">
            <option value="" disabled {% if s.id_mechanik is none %}selected{% endif %}>
                -- Vyber mechanika --
            </option>

            {% for m in mechanici %}
                <option value="{{ m.ID_uzivatele }}"
                    {% if s.id_mechanik == m.ID_uzivatele %}selected{% endif %}>
                    {{ m.jmeno }} {{ m.prijmeni }}
                </option>
            {% endfor %}
        </select>

        <button type="submit" class="btn-small">Uložit</button>
    </form>
    {% endfor %}
    </td>
    <td>
        {% if o.id_stavu == 3 or o.id_stavu == 4 %}
            <form action="/dashboard/admin/delete_objednavka" method="post" onsubmit="return confirm('Opravdu smazat tuto objednávku? Tato akce je nevratná.');">
                <input type="hidden" name="id_obj" value="{{ o.id_objednavky }}">
                <button type="submit" style="background-color: #d9534f; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
                    Smazat
                </button>
            </form>
        {% else %}
            <span style="color: #aaa;">Nelze smazat</span>
        {% endif %}
    </td>

  </tr>
  {% endfor %}
</table>

{% endblock %}