{% extends "base.html" %}
{% block title %}Dashboard Admin{% endblock %}
{% block content %}

<h1>Jsi p콏ihl치코en jako admin!</h1>

<div class="dashboard-actions">
    <a href="/dashboard/admin/users" class="btn btn-success">游논 Spravovat u쬴vatele</a>
</div>

<div class="table-container">
    <table>
      <tr>
        <th>ID</th>
        <th>Zna캜ka</th>
        <th>Datum</th>
        <th>Pozn치mka</th>
        <th>Stav</th>
        <th>Pr치ce & Mechanici</th>
        <th>Akce</th>
      </tr>
      {% for o in objednavky %}
      <tr>
        <td>{{ o.id_objednavky }}</td>
        <td>{{ o.znacka }}</td>
        <td>{{ o.datum }}</td>
        <td>{{ o.poznamka }}</td>
        <td>{{ o.stav }}</td>
        <td class="admin-work-cell">
          {% for s in o.servisy %}
            <div class="work-item d-flex flex-column gap-sm">
                <div style="font-weight: bold;">{{ s.prace_nazev }}</div>
                
                <form action="/dashboard/admin/pridel_mechanik" method="post" class="inline-form">
                    <input type="hidden" name="id_servisu" value="{{ s.id }}">
                    <select name="id_mechanik" class="w-auto m-0 btn-small">
                        <option value="" disabled {% if s.id_mechanik is none %}selected{% endif %}>
                            -- Vyber mechanika --
                        </option>
                        {% for m in mechanici %}
                            <option value="{{ m.ID_uzivatele }}" {% if s.id_mechanik == m.ID_uzivatele %}selected{% endif %}>
                                {{ m.jmeno }} {{ m.prijmeni }}
                            </option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn-small btn-secondary">OK</button>
                </form>
            </div>
          {% endfor %}
    
          <form action="/dashboard/admin/pridat_praci" method="post" class="add-work-form">
              <input type="hidden" name="id_obj" value="{{ o.id_objednavky }}">
              <div class="d-flex gap-sm">
                  <select name="id_prace" required class="m-0">
                      <option value="" disabled selected>+ P콏idat pr치ci</option>
                      {% for p in prace %}
                          <option value="{{ p.ID_prace }}">{{ p.nazev_prace }}</option>
                      {% endfor %}
                  </select>
                  <button type="submit" class="btn-small">P콏idat</button>
              </div>
          </form>
        </td>

        <td>
            {% if o.id_stavu == 3 or o.id_stavu == 4 %}
                <form action="/dashboard/admin/delete_objednavka" method="post" onsubmit="return confirm('Opravdu smazat?');" class="m-0">
                    <input type="hidden" name="id_obj" value="{{ o.id_objednavky }}">
                    <button type="submit" class="btn-small btn-danger">Smazat</button>
                </form>
            {% else %}
                <span class="text-muted">Aktivn칤</span>
            {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
</div>

{% endblock %}